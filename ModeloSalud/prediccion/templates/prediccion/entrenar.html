{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrenar Modelo - Sistema IA</title>
    <link rel="stylesheet" href="{% static 'prediccion/css/prediccion.css' %}">
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <h1>ğŸ¥ Sistema de Salud - IA</h1>
            <div class="nav-links">
                <a href="{% url 'index' %}">ğŸ  Inicio</a>
                <a href="/prediccion/">ğŸ“Š Dashboard</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="header">
            <h2>ğŸ§  Entrenar Modelo de PredicciÃ³n</h2>
            <p>RegresiÃ³n lineal para predicciÃ³n de demanda</p>
        </div>

        {% if not entrenado %}
        <div class="confirm-card">
            <div class="confirm-icon">ğŸ¤–</div>
            <h3>Entrenar modelo de regresiÃ³n lineal</h3>
            <p>El proceso de entrenamiento incluye:</p>
            <ol>
                <li>Cargar datos histÃ³ricos de la base de datos</li>
                <li>Normalizar variables (dÃ­a, mes, feriado)</li>
                <li>Entrenar modelo de regresiÃ³n lineal mÃºltiple</li>
                <li>Calcular precisiÃ³n (RÂ² score)</li>
                <li>Guardar modelo para predicciones futuras</li>
            </ol>
            
            <form method="POST">
                {% csrf_token %}
                <button type="submit" class="btn btn-success btn-large">
                    Entrenar Modelo
                </button>
                <a href="{% url 'prediccion_home' %}" class="btn btn-secondary">Cancelar</a>
            </form>
        </div>
        {% else %}
        
        <!-- Resultados del entrenamiento -->
        <div class="results-container" style="margin-top: 30px;">
            <h2 style="color: #2ecc71; text-align: center;">âœ… Modelo Entrenado Exitosamente</h2>
            
            <div class="metrics-summary" style="background: #e8f5e9; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h3 style="text-align: center;">ğŸ“Š MÃ©tricas del Modelo</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px;">
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <strong>RÂ² Score:</strong><br>{{ resultado.metricas.r2_score|floatformat:3 }}
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <strong>MAE:</strong><br>{{ resultado.metricas.mae|floatformat:2 }} pacientes
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <strong>RMSE:</strong><br>{{ resultado.metricas.rmse|floatformat:2 }} pacientes
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <strong>PrecisiÃ³n Entrenamiento:</strong><br>{% widthratio resultado.metricas.precision_train 1 100 %}%
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                        <strong>PrecisiÃ³n Prueba:</strong><br>{% widthratio resultado.metricas.precision_test 1 100 %}%
                    </div>
                </div>
            </div>
            
            <!-- GrÃ¡fico de Predicciones vs Valores Reales -->
            <div class="chart-container" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
                <h3>Predicciones vs Valores Reales</h3>
                <img src="data:image/png;base64,{{ resultado.grafico_predicciones }}" alt="Predicciones vs Valores Reales" style="max-width: 100%; height: auto;">
            </div>
            
            <!-- GrÃ¡fico de MÃ©tricas -->
            <div class="chart-container" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
                <h3>MÃ©tricas del Modelo</h3>
                <img src="data:image/png;base64,{{ resultado.grafico_metricas }}" alt="MÃ©tricas del Modelo" style="max-width: 100%; height: auto;">
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <a href="{% url 'prediccion_home' %}" class="btn" style="font-size: 16px; padding: 12px 30px;">
                    ğŸ  Volver al Inicio
                </a>
                <a href="{% url 'hacer_prediccion' %}" class="btn btn-success" style="font-size: 16px; padding: 12px 30px;">
                    ğŸ”® Hacer Predicciones
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</body>
</html>
