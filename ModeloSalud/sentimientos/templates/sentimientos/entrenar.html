{% extends 'sentimientos/base.html' %}

{% block title %}Entrenar Modelo{% endblock %}

{% block extra_css %}
{% load static %}
<link rel="stylesheet" href="{% static 'sentimientos/css/entrenar.css' %}">
{% endblock %}

{% block content %}

<div class="train-container">
    <h2>üß† Entrenar Modelo de IA</h2>
    
    <div class="info-box">
        <h3>¬øQu√© hace el entrenamiento?</h3>
        <p>El modelo de red neuronal aprender√° a clasificar comentarios como positivos o negativos bas√°ndose en los datos existentes.</p>
    </div>
    
    <div class="process-steps">
        <h3>Proceso de Entrenamiento:</h3>
        <ol>
            <li><strong>Limpieza de texto:</strong> Se eliminan URLs, caracteres especiales y palabras vac√≠as</li>
            <li><strong>Vectorizaci√≥n TF-IDF:</strong> Convierte el texto en n√∫meros que la IA puede procesar</li>
            <li><strong>Divisi√≥n de datos:</strong> 80% para entrenar, 20% para validar</li>
            <li><strong>Entrenamiento de red neuronal:</strong> Modelo con capas Dense y Dropout</li>
            <li><strong>Evaluaci√≥n:</strong> Se calcula la precisi√≥n del modelo</li>
        </ol>
    </div>
    
    <div class="warning-box">
        <h3>‚ö†Ô∏è Importante</h3>
        <p>El entrenamiento puede tardar varios minutos dependiendo de la cantidad de datos.</p>
        <p>Se necesitan al menos 10 comentarios para entrenar el modelo.</p>
    </div>
    
    {% if not entrenado %}
    <form method="post" style="margin-top: 30px;">
        {% csrf_token %}
        <button type="submit" class="btn" style="font-size: 18px; padding: 15px 40px;">
            üöÄ Iniciar Entrenamiento
        </button>
        <br><br>
        <a href="{% url 'sentimientos_home' %}" class="btn btn-secondary">Cancelar</a>
    </form>
    {% else %}
    
    <!-- Resultados del entrenamiento -->
    <div class="results-container" style="margin-top: 30px;">
        <h2>‚úÖ Resultados del Entrenamiento</h2>
        
        <div class="metrics-summary" style="background: #e8f5e9; padding: 20px; border-radius: 10px; margin: 20px 0;">
            <h3>üìä M√©tricas del Modelo</h3>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
                <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                    <strong>Accuracy:</strong> {% widthratio resultado.metricas.accuracy 1 100 %}%
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                    <strong>Precisi√≥n:</strong> {% widthratio resultado.metricas.precision 1 100 %}%
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                    <strong>Recall:</strong> {% widthratio resultado.metricas.recall 1 100 %}%
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                    <strong>F1-Score:</strong> {% widthratio resultado.metricas.f1_score 1 100 %}%
                </div>
            </div>
        </div>
        
        <!-- Gr√°fico de Matriz de Confusi√≥n -->
        <div class="chart-container" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
            <h3>Matriz de Confusi√≥n</h3>
            <img src="data:image/png;base64,{{ resultado.grafico_confusion }}" alt="Matriz de Confusi√≥n" style="max-width: 100%; height: auto;">
        </div>
        
        <!-- Gr√°fico de M√©tricas -->
        <div class="chart-container" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
            <h3>M√©tricas del Modelo</h3>
            <img src="data:image/png;base64,{{ resultado.grafico_metricas }}" alt="M√©tricas del Modelo" style="max-width: 100%; height: auto;">
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <a href="{% url 'sentimientos_home' %}" class="btn" style="font-size: 16px; padding: 12px 30px;">
                üè† Volver al Inicio
            </a>
            <a href="{% url 'predecir' %}" class="btn" style="font-size: 16px; padding: 12px 30px; background: #2ecc71;">
                üîÆ Probar Predicciones
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
